<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warehouse Section Locator</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    input[type="text"] {
      padding: 10px; font-size: 16px; width: 300px;
    }
    #result { margin-top: 10px; font-size: 18px; font-weight: bold; }
    svg { max-width: 1000px; margin-top: 20px; border: 1px solid #ccc; }
    .section {
      fill: white; stroke: red; stroke-width: 0.5;
    }
    .highlight { fill: yellow !important; stroke: black; stroke-width: 1.5; }
    .walkway { fill: #32cd32; opacity: 0.4; }
    .aisle-label { font-size: 10px; font-weight: bold; fill: black; }
  </style>
</head>
<body>
  <h1>üè≠ Warehouse Section Locator</h1>
  <p>Enter Item Code:</p>
  <input id="searchBox" type="text" placeholder="e.g. LCQ" />
  <div id="result"></div>

  <svg viewBox="0 0 1000 600">
    <!-- Walkway -->
    <rect x="0" y="270" width="1000" height="60" class="walkway" />

    <!-- Dynamic Sections Will Go Here -->
    <g id="aisles"></g>
  </svg>

  <script>
    const aisleConfig = {
      A: { front: 4, back: 9 },
      B: { front: 4, back: 9 },
      C: { front: 4, back: 9 },
      D: { front: 4, back: 12 },
      E: { front: 4, back: 12 },
      F: { front: 4, back: 12 },
      G: { front: 4, back: 12 },
      H: { front: 4, back: 12 },
      I: { front: 4, back: 12 },
      J: { front: 1, back: 0 }
    };

    const aisleSpacing = 80;
    const sectionSize = 12;
    const padding = 2;
    const svg = document.getElementById("aisles");

    function drawSections() {
      let index = 0;
      for (let aisle in aisleConfig) {
        const { front, back } = aisleConfig[aisle];
        const x = index * aisleSpacing + 20;

        // Labels
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", 20);
        label.setAttribute("class", "aisle-label");
        label.textContent = aisle;
        svg.appendChild(label);

        // FRONT: Top side (before walkway)
        for (let i = 0; i < front; i++) {
          ["Left", "Right"].forEach((side, sIndex) => {
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", x + sIndex * (sectionSize + padding));
            rect.setAttribute("y", 40 + i * (sectionSize + padding));
            rect.setAttribute("width", sectionSize);
            rect.setAttribute("height", sectionSize);
            rect.setAttribute("class", "section");
            rect.setAttribute("id", `${aisle}-Top-BW-${side}-${i + 1}`);
            svg.appendChild(rect);
          });
        }

        // BACK: Bottom side (after walkway)
        for (let i = 0; i < back; i++) {
          ["Left", "Right"].forEach((side, sIndex) => {
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", x + sIndex * (sectionSize + padding));
            rect.setAttribute("y", 350 + i * (sectionSize + padding));
            rect.setAttribute("width", sectionSize);
            rect.setAttribute("height", sectionSize);
            rect.setAttribute("class", "section");
            rect.setAttribute("id", `${aisle}-Top-AW-${side}-${i + 1}`);
            svg.appendChild(rect);
          });
        }

        // Aisle J special case (long single block)
        if (aisle === 'J') {
          const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
          rect.setAttribute("x", 100);
          rect.setAttribute("y", 550);
          rect.setAttribute("width", 800);
          rect.setAttribute("height", 30);
          rect.setAttribute("class", "section");
          rect.setAttribute("id", "J-Full");
          svg.appendChild(rect);
        }

        index++;
      }
    }

    function clearHighlights() {
      document.querySelectorAll(".section").forEach(el => el.classList.remove("highlight"));
    }

    async function searchItem() {
      const query = document.getElementById("searchBox").value.trim().toUpperCase();
      const response = await fetch("warehouse_inventory_map.csv");
      const text = await response.text();
      const rows = text.split("\n").slice(1);
      const data = rows.map(row => {
        const [code, aisle, level, block, side, section] = row.split(",");
        return { code, aisle, level, block, side, section };
      });

      const resultBox = document.getElementById("result");
      clearHighlights();
      const match = data.find(r => r.code === query);

      if (match) {
        const { aisle, level, block, side, section } = match;
        const id = (aisle === 'J' || !block || !side || !section)
          ? (aisle === 'J' ? 'J-Full' : aisle)
          : `${aisle}-${level}-${block.replace(/ /g, '')}-${side}-${section}`;

        const el = document.getElementById(id);
        if (el) el.classList.add("highlight");

        resultBox.textContent = `‚úÖ Found: Aisle ${aisle} ${section ? `| Section ${section} ${side}, ${block}` : ''}`;
      } else {
        resultBox.textContent = "‚ö†Ô∏è Item not found";
      }
    }

    document.getElementById("searchBox").addEventListener("input", searchItem);
    drawSections();
  </script>
</body>
</html>
